{"ast":null,"code":"import { getAllPark, addPark, deletePark, updatePark, getAllArea } from '@/api/request';\nimport dayjs from 'dayjs';\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      tableData: [],\n      currentPage: 1,\n      areaList: [],\n      addShow: false,\n      newForm: {\n        areaid: '',\n        createName: \"\",\n        createTime: \"\",\n        location: \"\",\n        price: 0,\n        stallId: 0,\n        status: 0,\n        images: []\n      },\n      editShow: false,\n      editForm: {}\n    };\n  },\n  computed: {\n    tableDataFilter() {\n      return this.tableData.slice((this.currentPage - 1) * 10, this.currentPage * 10);\n    }\n  },\n  methods: {\n    closeDia() {\n      this.addShow = false;\n      this.editShow = false;\n      this.editForm = {};\n      this.newForm = {\n        areaid: '',\n        createName: \"\",\n        createTime: \"\",\n        location: \"\",\n        price: 0,\n        stallId: 0,\n        status: 0\n      };\n    },\n    editDia(item) {\n      this.editShow = true;\n      this.editForm = item;\n    },\n    editStall() {\n      const data = {\n        areaid: this.editForm.areaid,\n        createName: this.editForm.createName,\n        createTime: dayjs(this.editForm.createTime).format('YYYY-MM-DDTHH:mm:ss'),\n        location: this.editForm.location,\n        price: this.editForm.price,\n        stallId: this.editForm.stallId,\n        status: this.editForm.status\n      };\n      updatePark(data).then(() => {\n        this.$notify({\n          title: '成功',\n          message: '修改成功',\n          type: 'success'\n        });\n        this.closeDia();\n        this.init();\n      });\n    },\n    addStall() {\n      const formData = new FormData();\n      this.newForm.images.forEach(item => {\n        formData.append('images', item.raw);\n      });\n      formData.append(areaid, this.newForm.areaid);\n      formData.append('createName', this.$store.state.MyInfo.email);\n      formData.append('createTime', dayjs(new Date()).format('YYYY-MM-DDTHH:mm:ss'));\n      formData.append('location', this.newForm.location);\n      formData.append('price', this.newForm.price);\n      formData.append('stallId', Math.floor(Date.now() / 1000) + Math.floor(Math.random() * 1000));\n      formData.append('status', 0);\n      addPark(data).then(() => {\n        this.$notify({\n          title: '成功',\n          message: '添加成功',\n          type: 'success'\n        });\n        this.closeDia();\n        this.init();\n      });\n    },\n    deletePark(row) {\n      this.$confirm('确定删除该车位吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        deletePark([row.stallId]).then(() => {\n          this.$message.success('删除成功');\n          this.init();\n        });\n      });\n    },\n    init() {\n      getAllPark().then(res => {\n        this.tableData = res.data.data;\n        getAllArea().then(area => {\n          this.areaList = area.data.data;\n          this.tableData.forEach(item => {\n            item.createTime = dayjs(item.createTime).format('YYYY-MM-DD HH:mm:ss');\n            this.areaList.map(area => {\n              if (item.areaid === area.areaid) {\n                item.areaName = area.areaName;\n              }\n            });\n          });\n        });\n      });\n    }\n  },\n  created() {\n    this.init();\n  }\n};","map":{"version":3,"names":["getAllPark","addPark","deletePark","updatePark","getAllArea","dayjs","axios","data","tableData","currentPage","areaList","addShow","newForm","areaid","createName","createTime","location","price","stallId","status","images","editShow","editForm","computed","tableDataFilter","slice","methods","closeDia","editDia","item","editStall","format","then","$notify","title","message","type","init","addStall","formData","FormData","forEach","append","raw","$store","state","MyInfo","email","Date","Math","floor","now","random","row","$confirm","confirmButtonText","cancelButtonText","$message","success","res","area","map","areaName","created"],"sources":["D:\\CODE\\park\\park-vue\\web\\src\\pages\\home\\stallManage.vue"],"sourcesContent":["<template>\r\n  <div class=\"area-manage\" style=\"padding: 20px\">\r\n    <el-button type=\"primary\" @click=\"addShow = true\">新增车位</el-button>\r\n    <el-table :data=\"tableDataFilter\" style=\"width: 100%; margin-top: 20px\" border>\r\n      <el-table-column prop=\"stallId\" label=\"车位编号\"></el-table-column>\r\n      <el-table-column prop=\"areaName\" label=\"所在区域\"></el-table-column>\r\n      <el-table-column prop=\"location\" label=\"具体位置\"></el-table-column>\r\n      <el-table-column prop=\"price\" label=\"价格\">\r\n        <template #default=\"scope\">\r\n          {{ scope.row.price }}元/小时\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"status\" label=\"车位状态\">\r\n        <template #default=\"scope\">\r\n          <el-tag type=\"success\" v-if=\"scope.row.status === 0\">空闲</el-tag>\r\n          <el-tag type=\"warning\" v-if=\"scope.row.status === 1\">已预定</el-tag>\r\n          <el-tag type=\"error\" v-if=\"scope.row.status === 2\">已停车</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"createTime\" label=\"创建时间\"></el-table-column>\r\n      <el-table-column prop=\"createName\" label=\"创建人\"></el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" width=\"150px\">\r\n        <template #default=\"scope\">\r\n          <el-button type=\"text\" size=\"small\" @click=\"editDia(scope.row)\">编辑</el-button>\r\n          <el-button type=\"text\" size=\"small\" @click=\"deletePark(scope.row)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div style=\"margin-top: 20px\">\r\n      <el-pagination background layout=\"prev, pager, next\" :total=\"tableData.length\"\r\n        v-model:current-page=\"currentPage\"></el-pagination>\r\n    </div>\r\n    <el-dialog v-if=\"addShow\" v-model=\"addShow\" title=\"新增车位\" @close=\"closeDia\">\r\n      <el-form :data=\"newForm\" label-width=\"100px\">\r\n        <el-form-item name=\"areaid\" label=\"所在区域:\">\r\n          <el-select v-model=\"newForm.areaid\">\r\n            <el-option v-for=\"item in areaList\" :key=\"item.areaid\" :label=\"item.areaName\"\r\n              :value=\"item.areaid\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item name=\"location\" label=\"具体位置:\">\r\n          <el-input v-model=\"newForm.location\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item name=\"price\" label=\"价格:\">\r\n          <el-input-number min=\"0\" v-model=\"newForm.price\"></el-input-number>\r\n        </el-form-item>\r\n        <el-form-item name=\"images\" label=\"车位照片\">\r\n          <el-upload :auto-upload=\"false\" limit=\"3\" v-model:file-list=\"newForm.images\" action=\"\" list-type=\"picture-card\">\r\n            <el-icon>\r\n              <Plus />\r\n            </el-icon>\r\n          </el-upload>\r\n        </el-form-item>\r\n        <div>\r\n          <el-button @click=\"closeDia\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"addStall\">\r\n            确认\r\n          </el-button>\r\n        </div>\r\n      </el-form>\r\n    </el-dialog>\r\n    <el-dialog v-if=\"editShow\" v-model=\"editShow\" title=\"编辑车位\" @close=\"closeDia\">\r\n      <el-form :data=\"editForm\" label-width=\"100px\">\r\n        <el-form-item name=\"areaid\" label=\"所在区域:\">\r\n          <el-select v-model=\"editForm.areaid\">\r\n            <el-option v-for=\"item in areaList\" :key=\"item.areaid\" :label=\"item.areaName\"\r\n              :value=\"item.areaid\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item name=\"location\" label=\"具体位置:\">\r\n          <el-input v-model=\"editForm.location\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item name=\"price\" label=\"价格:\">\r\n          <el-input-number min=\"0\" v-model=\"editForm.price\"></el-input-number>\r\n        </el-form-item>\r\n        <div>\r\n          <el-button @click=\"closeDia\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"editStall\">\r\n            确认\r\n          </el-button>\r\n        </div>\r\n      </el-form>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getAllPark, addPark, deletePark, updatePark, getAllArea } from '@/api/request'\r\nimport dayjs from 'dayjs'\r\nimport axios from 'axios'\r\nexport default {\r\n  data() {\r\n    return {\r\n      tableData: [\r\n      ],\r\n      currentPage: 1,\r\n      areaList: [],\r\n      addShow: false,\r\n      newForm: {\r\n        areaid: '',\r\n        createName: \"\",\r\n        createTime: \"\",\r\n        location: \"\",\r\n        price: 0,\r\n        stallId: 0,\r\n        status: 0,\r\n        images:[]\r\n      },\r\n      editShow: false,\r\n      editForm: {\r\n\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    tableDataFilter() {\r\n      return this.tableData.slice((this.currentPage - 1) * 10, this.currentPage * 10)\r\n    }\r\n  },\r\n  methods: {\r\n    closeDia() {\r\n      this.addShow = false\r\n      this.editShow = false\r\n      this.editForm = {}\r\n      this.newForm = {\r\n        areaid: '',\r\n        createName: \"\",\r\n        createTime: \"\",\r\n        location: \"\",\r\n        price: 0,\r\n        stallId: 0,\r\n        status: 0\r\n      }\r\n    },\r\n    editDia(item) {\r\n      this.editShow = true\r\n      this.editForm = item\r\n    },\r\n    editStall() {\r\n      const data = {\r\n        areaid: this.editForm.areaid,\r\n        createName: this.editForm.createName,\r\n        createTime: dayjs(this.editForm.createTime).format('YYYY-MM-DDTHH:mm:ss'),\r\n        location: this.editForm.location,\r\n        price: this.editForm.price,\r\n        stallId: this.editForm.stallId,\r\n        status: this.editForm.status\r\n      }\r\n      updatePark(data).then(() => {\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '修改成功',\r\n          type: 'success'\r\n        })\r\n        this.closeDia()\r\n        this.init()\r\n      })\r\n    },\r\n    addStall() {\r\n      const formData = new FormData()\r\n      this.newForm.images.forEach(item => {\r\n        formData.append('images', item.raw)\r\n      })\r\n      formData.append(areaid, this.newForm.areaid)\r\n      formData.append('createName', this.$store.state.MyInfo.email)\r\n      formData.append('createTime', dayjs(new Date()).format('YYYY-MM-DDTHH:mm:ss'))\r\n      formData.append('location', this.newForm.location)\r\n      formData.append('price', this.newForm.price)\r\n      formData.append('stallId', Math.floor(Date.now() / 1000) + Math.floor(Math.random() * 1000))\r\n      formData.append('status', 0)\r\n      addPark(data).then(() => {\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '添加成功',\r\n          type: 'success'\r\n        })\r\n        this.closeDia()\r\n        this.init()\r\n      })\r\n    },\r\n    deletePark(row) {\r\n      this.$confirm('确定删除该车位吗？', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        deletePark([row.stallId]).then(() => {\r\n          this.$message.success('删除成功')\r\n          this.init()\r\n        })\r\n      })\r\n    },\r\n    init() {\r\n      getAllPark().then(res => {\r\n        this.tableData = res.data.data\r\n        getAllArea().then(area => {\r\n          this.areaList = area.data.data\r\n          this.tableData.forEach(item => {\r\n            item.createTime = dayjs(item.createTime).format('YYYY-MM-DD HH:mm:ss')\r\n            this.areaList.map(area => {\r\n              if (item.areaid === area.areaid) {\r\n                item.areaName = area.areaName\r\n              }\r\n            })\r\n          })\r\n        })\r\n      })\r\n    }\r\n  },\r\n  created() {\r\n    this.init()\r\n  }\r\n}\r\n</script>\r\n\r\n<style></style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}