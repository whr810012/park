{"ast":null,"code":"import AMapLoader from \"@amap/amap-jsapi-loader\";\nimport { getGoodsDetail, buyGoods } from '@/api/request';\nimport { space } from '@/utils/utils';\nexport default {\n  data() {\n    return {\n      goodsDetail: {},\n      time: '',\n      show: false,\n      map: null\n    };\n  },\n  components: {},\n  computed: {\n    goodsId() {\n      return this.$route.query.goodsId;\n    },\n    myLOCATION() {\n      return localStorage.getItem('myLocation');\n    },\n    distance() {\n      let myLocation = this.myLOCATION;\n      myLocation = JSON.parse(myLocation);\n      if (!myLocation) {\n        if (document.getElementById('container')) {\n          this.getMyMAP();\n          myLocation = localStorage.getItem('myLocation');\n          myLocation = JSON.parse(myLocation);\n        } else {\n          return '...';\n        }\n      }\n      console.log(this.goodsDetail.lat, this.goodsDetail.lng, myLocation[1], myLocation[0]);\n      return space(this.goodsDetail.lat, this.goodsDetail.lng, myLocation[1], myLocation[0]);\n    }\n  },\n  methods: {\n    open() {\n      this.show = true;\n    },\n    confirm() {\n      this.$confirm('是否确认交易', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        const data = {\n          goodsId: this.goodsId,\n          time: this.time,\n          uid: this.$store.state.MyInfo.uid\n        };\n        buyGoods(data).then(() => {});\n        this.$message({\n          type: 'success',\n          message: '交易成功!'\n        });\n        this.show = false;\n      });\n    },\n    getMyMAP() {\n      AMapLoader.load({\n        key: \"a05ab04a5dbe61ad2fad7b664790a18f\",\n        // 申请好的Web端开发者Key，首次调用 load 时必填\n        version: \"2.0\",\n        // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15\n        plugins: [] // 需要使用的的插件列表，如比例尺'AMap.Scale'等\n      }).then(AMap => {\n        this.map = new AMap.Map(\"container\", {\n          // 设置地图容器id\n          viewMode: \"2D\",\n          // 是否为3D地图模式\n          zoom: 14,\n          // 初始化地图级别\n          center: [118.28752699999995, 35.12255099999999] // 初始化地图中心点位置\n        });\n        this.map.plugin('AMap.Geolocation', function () {\n          var geolocation = new AMap.Geolocation({\n            enableHighAccuracy: true,\n            // 是否使用高精度定位，默认：true\n            timeout: 10000,\n            // 设置定位超时时间，默认：无穷大\n            offset: [10, 20],\n            // 定位按钮的停靠位置的偏移量\n            zoomToAccuracy: true,\n            //  定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\n            position: 'RB' //  定位按钮的排放位置,  RB表示右下\n          });\n          geolocation.getCurrentPosition(function (status, result) {\n            if (status == 'complete') {\n              onComplete(result);\n            } else {\n              onError(result);\n            }\n          });\n          function onComplete(data) {\n            // data是具体的定位信息\n            console.log('经纬度', data.position);\n            localStorage.setItem('myLocation', JSON.stringify(data.position));\n          }\n          function onError(data) {\n            // 定位出错\n            if (data.message.includes(\"permission denied\")) {\n              console.log('定位权限被拒绝，请检查浏览器设置。', data);\n            } else {\n              console.log('定位失败', data);\n            }\n          }\n        });\n      }).catch(e => {\n        console.log(e);\n      });\n    }\n  },\n  created() {\n    console.log(this.goodsId);\n    getGoodsDetail({\n      goodsId: this.goodsId\n    }).then(res => {\n      this.goodsDetail = res.data.data;\n      console.log(res.data.data);\n      this.goodsDetail.filesJson = JSON.parse(res.data.data.filesJson);\n      console.log(this.goodsDetail.filesJson);\n      this.goodsDetail.filesJson.forEach(img => {\n        const mimeType = img.contentType;\n        img.url = `data:${mimeType};base64,${img.base64}`;\n      });\n      console.log(this.goodsDetail.filesJson);\n    });\n    this.$nextTick(() => {\n      this.getMyMAP();\n    });\n  }\n};","map":{"version":3,"names":["AMapLoader","getGoodsDetail","buyGoods","space","data","goodsDetail","time","show","map","components","computed","goodsId","$route","query","myLOCATION","localStorage","getItem","distance","myLocation","JSON","parse","document","getElementById","getMyMAP","console","log","lat","lng","methods","open","confirm","$confirm","confirmButtonText","cancelButtonText","type","then","uid","$store","state","MyInfo","$message","message","load","key","version","plugins","AMap","Map","viewMode","zoom","center","plugin","geolocation","Geolocation","enableHighAccuracy","timeout","offset","zoomToAccuracy","position","getCurrentPosition","status","result","onComplete","onError","setItem","stringify","includes","catch","e","created","res","filesJson","forEach","img","mimeType","contentType","url","base64","$nextTick"],"sources":["C:\\Users\\Administrator\\Desktop\\ershou\\src\\pages\\goods\\buyGoods.vue"],"sourcesContent":["<template>\r\n    <div class=\"buyGoods\">\r\n        <el-carousel indicator-position=\"outside\" type=\"card\">\r\n            <el-carousel-item v-for=\"item in this.goodsDetail.filesJson\" :key=\"item\">\r\n                <!-- 原来尺寸大小展示 -->\r\n                <el-image style=\"width: 100%; height: 100%\" fit=\"contain\" :src=\"item.url\"></el-image>\r\n            </el-carousel-item>\r\n        </el-carousel>\r\n        <div class=\"goodsInfo\">\r\n            <div class=\"title\">{{ goodsDetail.name }}</div>\r\n            <div class=\"goods-detail-item\"><span class=\"item-title\">原价：</span>{{ goodsDetail.price }}</div>\r\n            <div class=\"goods-detail-item\" v-vif=\"goodsDetail.discount != 1\"><span class=\"item-title\">折扣：</span>{{\r\n                (goodsDetail.discount * 10).toFixed(1) }}折</div>\r\n            <div class=\"goods-detail-item\" v-if=\"goodsDetail.discount != 1\"><span class=\"item-title\">现价：</span>{{\r\n                (goodsDetail.price * (goodsDetail.discount * 100)) / 100 }}</div>\r\n            <div class=\"goods-detail-item\"><span class=\"item-title\">成色：</span>{{ goodsDetail.condition }}</div>\r\n            <div class=\"goods-detail-item\"><span class=\"item-title\">描述：</span>{{ goodsDetail.description }}</div>\r\n            <div class=\"goods-detail-item\"><span class=\"item-title\">交易地点：</span>{{ goodsDetail.address }}</div>\r\n            <div class=\"goods-detail-item\"><span class=\"item-title\">距离：</span>{{ distance }}千米</div>\r\n        </div>\r\n        <div style=\"text-align: center;margin-top: 20px; margin-bottom: 50px;\">\r\n            <el-button @click=\"open\" type=\"primary\">确定交易</el-button>\r\n        </div>\r\n        <el-dialog v-if=\"show\" title=\"确认交易时间\" v-model=\"show\" width=\"400px\">\r\n            <div style=\"display: flex; align-items: center;\">\r\n                交易时间：\r\n                <el-date-picker style=\"margin-left: 15px;\" v-model=\"time\" type=\"datetime\" placeholder=\"选择日期时间\">\r\n                </el-date-picker>\r\n            </div>\r\n            <el-button @click=\"confirm\" type=\"primary\" style=\"margin-top: 20px; margin-left: 50px;\">确认</el-button>\r\n        </el-dialog>\r\n        <div id=\"container\" style=\"width: 0px;height:0px\"></div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport AMapLoader from \"@amap/amap-jsapi-loader\";\r\nimport { getGoodsDetail, buyGoods } from '@/api/request'\r\nimport { space } from '@/utils/utils'\r\nexport default {\r\n    data() {\r\n        return {\r\n            goodsDetail: {},\r\n            time: '',\r\n            show: false,\r\n            map: null\r\n        }\r\n    },\r\n    components: {\r\n\r\n    },\r\n    computed: {\r\n        goodsId() {\r\n            return this.$route.query.goodsId\r\n        },\r\n        myLOCATION(){ return localStorage.getItem('myLocation')}, \r\n        distance() {\r\n            let myLocation = this.myLOCATION\r\n            myLocation = JSON.parse(myLocation)\r\n            if (!myLocation) {\r\n                if (document.getElementById('container')) {\r\n                    this.getMyMAP()\r\n                    myLocation = localStorage.getItem('myLocation')\r\n                    myLocation = JSON.parse(myLocation)\r\n                }else {\r\n                    return '...'\r\n                }\r\n            }\r\n            console.log(this.goodsDetail.lat, this.goodsDetail.lng, myLocation[1], myLocation[0]);\r\n            return space(this.goodsDetail.lat, this.goodsDetail.lng, myLocation[1], myLocation[0])\r\n        }\r\n    },\r\n    methods: {\r\n        open() {\r\n            this.show = true\r\n        },\r\n        confirm() {\r\n            this.$confirm('是否确认交易', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                const data = {\r\n                    goodsId: this.goodsId,\r\n                    time: this.time,\r\n                    uid: this.$store.state.MyInfo.uid\r\n                }\r\n                buyGoods(data).then(() => {\r\n\r\n                })\r\n                this.$message({\r\n                    type: 'success',\r\n                    message: '交易成功!'\r\n                })\r\n                this.show = false\r\n            })\r\n        },\r\n        getMyMAP() {\r\n            AMapLoader.load({\r\n                key: \"a05ab04a5dbe61ad2fad7b664790a18f\", // 申请好的Web端开发者Key，首次调用 load 时必填\r\n                version: \"2.0\", // 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15\r\n                plugins: [], // 需要使用的的插件列表，如比例尺'AMap.Scale'等\r\n            })\r\n                .then((AMap) => {\r\n                    this.map = new AMap.Map(\"container\", {\r\n                        // 设置地图容器id\r\n                        viewMode: \"2D\", // 是否为3D地图模式\r\n                        zoom: 14, // 初始化地图级别\r\n                        center: [118.28752699999995, 35.12255099999999], // 初始化地图中心点位置\r\n                    });\r\n                    this.map.plugin('AMap.Geolocation', function () {\r\n                        var geolocation = new AMap.Geolocation({\r\n                            enableHighAccuracy: true, // 是否使用高精度定位，默认：true\r\n                            timeout: 10000, // 设置定位超时时间，默认：无穷大\r\n                            offset: [10, 20],  // 定位按钮的停靠位置的偏移量\r\n                            zoomToAccuracy: true,  //  定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\r\n                            position: 'RB' //  定位按钮的排放位置,  RB表示右下\r\n                        })\r\n                        geolocation.getCurrentPosition(function (status, result) {\r\n                            if (status == 'complete') {\r\n                                onComplete(result)\r\n                            } else {\r\n                                onError(result)\r\n                            }\r\n                        });\r\n\r\n                        function onComplete(data) {\r\n                            // data是具体的定位信息\r\n                            console.log('经纬度', data.position);\r\n                            localStorage.setItem('myLocation', JSON.stringify(data.position))\r\n                        }\r\n\r\n                        function onError(data) {\r\n                            // 定位出错\r\n                            if (data.message.includes(\"permission denied\")) {\r\n                                console.log('定位权限被拒绝，请检查浏览器设置。', data);\r\n                            } else {\r\n                                console.log('定位失败', data);\r\n                            }\r\n                        }\r\n                    })\r\n                })\r\n                .catch((e) => {\r\n                    console.log(e)\r\n                });\r\n        }\r\n    },\r\n    created() {\r\n        console.log(this.goodsId);\r\n        getGoodsDetail({ goodsId: this.goodsId }).then(res => {\r\n            this.goodsDetail = res.data.data\r\n            console.log(res.data.data);\r\n            this.goodsDetail.filesJson = JSON.parse(res.data.data.filesJson)\r\n            console.log(this.goodsDetail.filesJson);\r\n            this.goodsDetail.filesJson.forEach(img => {\r\n                const mimeType = img.contentType\r\n                img.url = `data:${mimeType};base64,${img.base64}`;\r\n            })\r\n            console.log(this.goodsDetail.filesJson)\r\n        })\r\n        this.$nextTick(() => {\r\n            this.getMyMAP()\r\n        })\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.goodsInfo {\r\n    padding: 20px;\r\n    background-color: #f5f5f5;\r\n\r\n    .title {\r\n        color: #11192d;\r\n        font-family: PingFangSC-Semibold;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n        letter-spacing: 0;\r\n        line-height: 30px;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        display: -webkit-box;\r\n    }\r\n\r\n    .goods-detail-item {\r\n        padding-top: 10px;\r\n\r\n        .item-title {\r\n            color: #464646;\r\n        }\r\n    }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}