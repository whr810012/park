{"ast":null,"code":"import { getMarkers, subMarkers } from \"../../api/request.js\";\nexport default {\n  name: \"marksManage\",\n  data() {\n    return {\n      imageshow: false,\n      dialogFormVisible: false,\n      form: {\n        id: '',\n        lat: '',\n        lng: '',\n        name: '',\n        icon: '',\n        detail: '',\n        image: ''\n      },\n      tableData: [],\n      multipleSelection: []\n    };\n  },\n  methods: {\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n    addOptions() {\n      this.form = {\n        lat: '',\n        lng: '',\n        name: '',\n        icon: '',\n        detail: '',\n        image: ''\n      };\n      this.dialogFormVisible = true;\n    },\n    changeOptions() {\n      if (this.multipleSelection.length == 1) {\n        this.form = this.multipleSelection[0];\n        this.dialogFormVisible = true;\n      } else {\n        this.$message.warning('请选择一个选项进行修改');\n      }\n    },\n    handlePictureCardPreview(file) {\n      this.imageshow = true;\n      this.dialogImageUrl = file.url;\n    },\n    handleRemove(file) {\n      console.log(file);\n    },\n    handleExceed() {\n      this.$message.warning('最多上传4张图片');\n    },\n    handleChange(file, fileList) {\n      console.log(file, fileList);\n    },\n    uploadFrom() {\n      console.log(this.form);\n      const isChange = !!this.form.markerid;\n      if (this.form.lat && this.form.lng && this.form.name && this.form.icon && this.form.detail && this.form.image) {\n        if (isChange) {\n          this.$message.success('修改成功');\n          this.dialogFormVisible = false;\n        } else {\n          let formData = new FormData();\n          let obj = {\n            ...this.form\n          };\n          Object.keys(obj).forEach(key => {\n            formData.append(key, obj[key]);\n          });\n          // 确保 this.form.image 是一个数组并且存在\n          if (Array.isArray(this.form.image)) {\n            for (let i = 0; i < this.form.image.length; i++) {\n              const file = this.form.image[i].raw; // 假设 raw 是一个有效的 File 对象\n              if (file) {\n                formData.append(`files`, file); // 使用数组形式或不同的字段名\n              }\n            }\n          }\n          console.log(`数据：${formData.get(\"file\")}`);\n          subMarkers(formData).then(() => {\n            this.initMarkers();\n            this.$message.success('添加成功');\n            this.dialogFormVisible = false;\n          });\n        }\n      } else {\n        this.$message.warning('请填写完整信息');\n      }\n    },\n    initMarkers() {\n      getMarkers().then(res => {\n        this.tableData = res.data.data;\n        // console.log(\"filesJson:\", this.tableData); // 调试输出\n        this.tableData.forEach(item => {\n          item.image = JSON.parse(item.filesJson);\n          item.image.forEach(img => {\n            const mimeType = img.contentType; // 根据实际情况选择 MIME 类型\n            img.url = `data:${mimeType};base64,${img.base64}`;\n          });\n        });\n        console.log(this.tableData);\n      });\n    }\n  },\n  created() {\n    this.$store.commit(\"setBreadList\", [{\n      title: '地图管理'\n    }, {\n      title: '点位管理'\n    }]);\n    this.initMarkers();\n  }\n};","map":{"version":3,"names":["getMarkers","subMarkers","name","data","imageshow","dialogFormVisible","form","id","lat","lng","icon","detail","image","tableData","multipleSelection","methods","handleSelectionChange","val","addOptions","changeOptions","length","$message","warning","handlePictureCardPreview","file","dialogImageUrl","url","handleRemove","console","log","handleExceed","handleChange","fileList","uploadFrom","isChange","markerid","success","formData","FormData","obj","Object","keys","forEach","key","append","Array","isArray","i","raw","get","then","initMarkers","res","item","JSON","parse","filesJson","img","mimeType","contentType","base64","created","$store","commit","title"],"sources":["C:\\Users\\Administrator\\Desktop\\ershou\\src\\components\\mapmanage\\MarksManage.vue"],"sourcesContent":["<template>\r\n    <div class=\"options-manage\">\r\n        <div style=\"margin-bottom: 20px\">\r\n            <el-button type=\"primary\" @click=\"addOptions\">添加</el-button>\r\n            <el-button type=\"primary\" @click=\"changeOptions\">修改</el-button>\r\n            <el-button type=\"danger\">删除</el-button>\r\n        </div>\r\n        <el-table ref=\"multipleTableRef\" :data=\"tableData\" border style=\"width: 100%\"\r\n            @selection-change=\"handleSelectionChange\">\r\n            <el-table-column type=\"index\" label=\"序号\" width=\"120\" align=\"center\"></el-table-column>\r\n            <el-table-column type=\"selection\" :selectable=\"selectable\" width=\"55\" align=\"center\" />\r\n            <el-table-column property=\"lat\" label=\"经度\" align=\"center\" />\r\n            <el-table-column property=\"lng\" label=\"维度\" align=\"center\" />\r\n            <el-table-column property=\"name\" label=\"名称\" align=\"center\" />\r\n            <el-table-column property=\"icon\" label=\"类型\" align=\"center\" />\r\n            <el-table-column property=\"detail\" label=\"详情\" align=\"center\" />\r\n        </el-table>\r\n        <el-dialog v-if=\"dialogFormVisible\" v-model=\"dialogFormVisible\" title=\"添加位置信息\" width=\"500\">\r\n            <el-form :model=\"form\">\r\n                <el-form-item label=\"经度 (lat):\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"form.lat\" autocomplete=\"off\" />\r\n                </el-form-item>\r\n                <el-form-item label=\"纬度 (lng):\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"form.lng\" autocomplete=\"off\" />\r\n                </el-form-item>\r\n                <el-form-item label=\"名称:\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"form.name\" autocomplete=\"off\" />\r\n                </el-form-item>\r\n                <el-form-item label=\"类型:\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"form.icon\" autocomplete=\"off\" />\r\n                </el-form-item>\r\n                <el-form-item label=\"详情:\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"form.detail\" autocomplete=\"off\" type=\"textarea\" />\r\n                </el-form-item>\r\n                <el-form-item label=\"图片:\" :label-width=\"formLabelWidth\">\r\n                    <el-upload action=\"#\" v-model:file-list=\"form.image\" :auto-upload=\"false\" limit=\"4\"\r\n                        list-type=\"picture-card\" :on-preview=\"handlePictureCardPreview\" :on-remove=\"handleRemove\"\r\n                        :on-exceed=\"handleExceed\" :on-change=\"handleChange\" accept=\"image/jpg,image/jpeg,image/png\">\r\n                        <el-icon>\r\n                            <Plus />\r\n                        </el-icon>\r\n                    </el-upload>\r\n                    <el-dialog v-model=\"imageshow\">\r\n                        <img w-full :src=\"dialogImageUrl\" alt=\"Preview Image\" />\r\n                    </el-dialog>\r\n                </el-form-item>\r\n            </el-form>\r\n            <template #footer>\r\n                <div class=\"dialog-footer\">\r\n                    <el-button @click=\"dialogFormVisible = false\">取消</el-button>\r\n                    <el-button type=\"primary\" @click=\"uploadFrom\">\r\n                        确认\r\n                    </el-button>\r\n                </div>\r\n            </template>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { getMarkers, subMarkers } from \"../../api/request.js\";\r\nexport default {\r\n    name: \"marksManage\",\r\n    data() {\r\n        return {\r\n            imageshow: false,\r\n            dialogFormVisible: false,\r\n            form: {\r\n                id: '',\r\n                lat: '',\r\n                lng: '',\r\n                name: '',\r\n                icon: '',\r\n                detail: '',\r\n                image: ''\r\n            },\r\n            tableData: [],\r\n            multipleSelection: [],\r\n        }\r\n    },\r\n    methods: {\r\n        handleSelectionChange(val) {\r\n            this.multipleSelection = val\r\n        },\r\n        addOptions() {\r\n            this.form = {\r\n                lat: '',\r\n                lng: '',\r\n                name: '',\r\n                icon: '',\r\n                detail: '',\r\n                image: ''\r\n            }\r\n            this.dialogFormVisible = true\r\n        },\r\n        changeOptions() {\r\n            if (this.multipleSelection.length == 1) {\r\n                this.form = this.multipleSelection[0]\r\n                this.dialogFormVisible = true\r\n            } else {\r\n                this.$message.warning('请选择一个选项进行修改')\r\n            }\r\n        },\r\n        handlePictureCardPreview(file) {\r\n            this.imageshow = true\r\n            this.dialogImageUrl = file.url\r\n        },\r\n        handleRemove(file) {\r\n            console.log(file);\r\n        },\r\n        handleExceed() {\r\n            this.$message.warning('最多上传4张图片')\r\n        },\r\n        handleChange(file, fileList) {\r\n            console.log(file, fileList);\r\n        },\r\n        uploadFrom() {\r\n            console.log(this.form);\r\n            const isChange = !!this.form.markerid\r\n            if (this.form.lat && this.form.lng && this.form.name && this.form.icon && this.form.detail && this.form.image) {\r\n                if (isChange) {\r\n                    this.$message.success('修改成功')\r\n                    this.dialogFormVisible = false\r\n                } else {\r\n                    let formData = new FormData();\r\n                    let obj = { ...this.form };\r\n                    Object.keys(obj).forEach(key => {\r\n                        formData.append(key, obj[key]);\r\n                    })\r\n                    // 确保 this.form.image 是一个数组并且存在\r\n                    if (Array.isArray(this.form.image)) {\r\n                        for (let i = 0; i < this.form.image.length; i++) {\r\n                            const file = this.form.image[i].raw; // 假设 raw 是一个有效的 File 对象\r\n                            if (file) {\r\n                                formData.append(`files`, file); // 使用数组形式或不同的字段名\r\n                            }\r\n                        }\r\n                    }\r\n                    console.log(`数据：${formData.get(\"file\")}`);\r\n                    subMarkers(formData).then(() => {\r\n                        this.initMarkers()\r\n                        this.$message.success('添加成功')\r\n                        this.dialogFormVisible = false\r\n                    })\r\n                }\r\n            } else {\r\n                this.$message.warning('请填写完整信息')\r\n            }\r\n        },\r\n        initMarkers() {\r\n            getMarkers().then(res => {\r\n                this.tableData = res.data.data\r\n                // console.log(\"filesJson:\", this.tableData); // 调试输出\r\n                this.tableData.forEach(item => {\r\n                    item.image = JSON.parse(item.filesJson)\r\n                    item.image.forEach(img => {\r\n                        const mimeType = img.contentType // 根据实际情况选择 MIME 类型\r\n                        img.url = `data:${mimeType};base64,${img.base64}`;\r\n                    })\r\n                })\r\n                console.log(this.tableData);\r\n            })\r\n        }\r\n    },\r\n    created() {\r\n        this.$store.commit(\"setBreadList\", [{ title: '地图管理' }, { title: '点位管理' }]);\r\n        this.initMarkers()\r\n    },\r\n}\r\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}