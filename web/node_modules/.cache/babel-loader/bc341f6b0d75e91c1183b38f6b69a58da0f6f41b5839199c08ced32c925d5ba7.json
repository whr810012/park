{"ast":null,"code":"import { getMyInfo, changeUser } from '@/api/request';\nexport default {\n  name: 'myInfo',\n  data() {\n    return {\n      form: {},\n      show: false,\n      url: \"\"\n    };\n  },\n  computed: {\n    formData() {\n      return {\n        uid: this.$store.state.MyInfo.uid\n      };\n    }\n  },\n  methods: {\n    open() {\n      this.show = true;\n    },\n    change() {\n      const data = {\n        uid: this.$store.state.MyInfo.uid,\n        name: this.form.name,\n        xingbie: this.form.xingbie,\n        age: this.form.age,\n        telephone: this.form.telephone,\n        username: this.$store.state.MyInfo.username,\n        password: this.$store.state.MyInfo.password,\n        isadmin: this.$store.state.MyInfo.isadmin\n      };\n      changeUser(data).then(() => {\n        this.show = false;\n        this.$message.success('修改成功');\n        getMyInfo({\n          uid: this.$store.state.MyInfo.uid\n        }).then(res => {\n          const data = res.data.data[0];\n          if (data.img) {\n            data.img = JSON.parse(data.img);\n          }\n          this.$store.commit('setUserInfo', data);\n          localStorage.setItem('userInfo', JSON.stringify(data));\n          const mimeType = data.img.contentType;\n          this.url = `data:${mimeType};base64,${data.img.base64}`;\n        });\n      });\n    },\n    handleAvatarSuccess(res) {\n      console.log(res);\n      getMyInfo({\n        uid: this.$store.state.MyInfo.uid\n      }).then(res => {\n        const data = res.data.data[0];\n        if (data.img) {\n          data.img = JSON.parse(data.img);\n        }\n        this.$store.commit('setUserInfo', data);\n        localStorage.setItem('userInfo', JSON.stringify(data));\n        const mimeType = data.img.contentType;\n        this.url = `data:${mimeType};base64,${data.img.base64}`;\n      });\n    }\n  },\n  created() {\n    getMyInfo({\n      uid: this.$store.state.MyInfo.uid\n    }).then(res => {\n      this.form = res.data.data[0];\n      if (this.form.img) {\n        // 将json转换成对象\n        this.form.img = JSON.parse(this.form.img);\n        const mimeType = this.form.img.contentType;\n        this.url = `data:${mimeType};base64,${this.form.img.base64}`;\n      }\n      console.log(this.form);\n    });\n  }\n};","map":{"version":3,"names":["getMyInfo","changeUser","name","data","form","show","url","computed","formData","uid","$store","state","MyInfo","methods","open","change","xingbie","age","telephone","username","password","isadmin","then","$message","success","res","img","JSON","parse","commit","localStorage","setItem","stringify","mimeType","contentType","base64","handleAvatarSuccess","console","log","created"],"sources":["C:\\Users\\Administrator\\Desktop\\ershou\\src\\pages\\myInfo.vue"],"sourcesContent":["<template>\r\n  <div style=\"padding: 40px 20px 0 20px\">\r\n    <el-card style=\"width: 480px\" shadow=\"hover\">\r\n      <el-upload\r\n        class=\"avatar-uploader\"\r\n        action=\"http://localhost:3000/upLoadImage\"\r\n        :data=\"formData\"\r\n        :show-file-list=\"false\"\r\n        :on-success=\"handleAvatarSuccess\"\r\n        :before-upload=\"beforeAvatarUpload\"\r\n        style=\"background-color: aliceblue;width:100px;height:100px;display: flex;justify-content: center;align-items: center;\"\r\n      >\r\n        <img v-if=\"url\" style=\"width: 100px;height:100px;font-size: 60px;\" :src=\"url\" class=\"avatar\" />\r\n        <el-icon v-else style=\"width: 60px;height:60px;font-size: 60px;\" class=\"avatar-uploader-icon\"><Plus /></el-icon>\r\n      </el-upload>\r\n      <el-form>\r\n        <el-form-item label=\"昵称\" :label-width=\"formLabelWidth\">\r\n          {{ this.form.name }}\r\n        </el-form-item>\r\n        <el-form-item label=\"性别\" :label-width=\"formLabelWidth\">\r\n          {{ this.form.xingbie }}\r\n        </el-form-item>\r\n        <el-form-item label=\"年纪\" :label-width=\"formLabelWidth\">\r\n          {{ this.form.age }}\r\n        </el-form-item>\r\n        <el-form-item label=\"手机号\" :label-width=\"formLabelWidth\">\r\n          {{ this.form.telephone }}\r\n        </el-form-item>\r\n      </el-form>\r\n      <div style=\"text-align: right;\">\r\n        <el-button @click=\"open\" type=\"primary\" style=\"width: 100px;\">修改</el-button>\r\n      </div>\r\n    </el-card>\r\n    <el-dialog v-model=\"show\" v-if=\"show\" title=\"修改信息\" width=\"45%\">\r\n      <el-form :model=\"form\" label-position=\"right\">\r\n        <el-form-item label=\"昵称:\" label-width=\"70px\">\r\n          <el-input v-model=\"form.name\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"性别:\" label-width=\"70px\">\r\n          <el-input v-model=\"form.xingbie\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"年纪:\" label-width=\"70px\">\r\n          <el-input v-model=\"form.age\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"手机号:\" label-width=\"70px\">\r\n          <el-input v-model=\"form.telephone\" autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div style=\"text-align: right;\">\r\n        <el-button type=\"primary\" @click=\"change\">确定修改</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getMyInfo, changeUser } from '@/api/request'\r\nexport default {\r\n  name: 'myInfo',\r\n  data() {\r\n    return {\r\n      form: {},\r\n      show: false,\r\n      url:\"\"\r\n    }\r\n  },\r\n  computed:{\r\n    formData(){\r\n      return{\r\n        uid: this.$store.state.MyInfo.uid\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    open() {\r\n      this.show = true\r\n    },\r\n    change() {\r\n      const data = {\r\n        uid: this.$store.state.MyInfo.uid,\r\n        name: this.form.name,\r\n        xingbie: this.form.xingbie,\r\n        age: this.form.age,\r\n        telephone: this.form.telephone,\r\n        username: this.$store.state.MyInfo.username,\r\n        password: this.$store.state.MyInfo.password,\r\n        isadmin:this.$store.state.MyInfo.isadmin\r\n      }\r\n      changeUser(data).then(() => {\r\n        this.show = false\r\n        this.$message.success('修改成功')\r\n        getMyInfo({ uid: this.$store.state.MyInfo.uid }).then(res => {\r\n          const data = res.data.data[0]\r\n          if (data.img){\r\n            data.img = JSON.parse(data.img)\r\n          }\r\n          this.$store.commit('setUserInfo', data)\r\n          localStorage.setItem('userInfo', JSON.stringify(data))\r\n          const mimeType = data.img.contentType\r\n          this.url = `data:${mimeType};base64,${data.img.base64}`;\r\n        })\r\n      })\r\n    },\r\n    handleAvatarSuccess(res){\r\n      console.log(res);\r\n      getMyInfo({ uid: this.$store.state.MyInfo.uid }).then(res => {\r\n          const data = res.data.data[0]\r\n          if (data.img){\r\n            data.img = JSON.parse(data.img)\r\n          }\r\n          this.$store.commit('setUserInfo', data)\r\n          localStorage.setItem('userInfo', JSON.stringify(data))\r\n          const mimeType = data.img.contentType\r\n          this.url = `data:${mimeType};base64,${data.img.base64}`;\r\n        })\r\n    }\r\n  },\r\n  created() {\r\n    getMyInfo({ uid: this.$store.state.MyInfo.uid }).then(res => {\r\n      this.form = res.data.data[0]\r\n      if (this.form.img) {\r\n        // 将json转换成对象\r\n        this.form.img = JSON.parse(this.form.img)\r\n        const mimeType = this.form.img.contentType\r\n        this.url = `data:${mimeType};base64,${this.form.img.base64}`;\r\n      }\r\n      console.log(this.form);\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style></style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}